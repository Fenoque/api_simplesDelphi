program api_multvendas;

{$APPTYPE CONSOLE}

{$R *.res}

uses
  Horse,
  Horse.Jhonson,
  Horse.JWT,
  Horse.HandleException,
  System.JSON,
  System.SysUtils,
  Controllers.Produtos in 'src\Controllers\Controllers.Produtos.pas',
  Service.Base in 'src\Services\Service.Base.pas',
  Service.Produtos in 'src\Services\Service.Produtos.pas',
  Service.logs in 'src\Services\Service.logs.pas';

begin

  {$IFDEF DEBUG}
    IsConsole := False;
    ReportMemoryLeaksOnShutdown := True;
  {$ENDIF}

  THorse.Use(Jhonson());
  THorse.Use(HandleException);
//  THorse.Use(HorseJWT('123098765',
//                                THorseJWTConfig.New
//                                        .SkipRoutes(['/login'])));


//ideia de logs
  THorse.OnListen := THorseLoggerConsole.OnListen;
  THorse.OnRequest := THorseLoggerConsole.OnRequest;
  THorse.OnResponse := THorseLoggerConsole.OnResponse;
  THorse.OnError := THorseLoggerConsole.OnError;



TControllerProdutos.Registry;
//  TControllerAutenticacao.Registry;
//  TControllerUsuarios.Registry;

  THorse.Listen(9000,
                procedure
                begin
                  WriteLn(Format('API está funcionando em %s:%d', [THorse.Host, THorse.Port]));
                  WriteLn('Pressione ENTER para encerrar...');
                end);
  Readln;
end.
